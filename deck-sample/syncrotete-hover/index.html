<!DOCTYPE html>
<html lang="ja">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>MapLibre + Deck.GL Example</title>
    <script src="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.js"></script>
    <link href="https://unpkg.com/maplibre-gl@3.6.2/dist/maplibre-gl.css" rel="stylesheet" />
    <script src="https://unpkg.com/deck.gl@latest/dist.min.js"></script>
    <style>
        body,
        html {
            margin: 0;
            padding: 0;
            height: 100%;
        }

        #map {
            width: 100%;
            height: 100vh;
        }
    </style>
</head>

<body>
    <div id="map"></div>

    <script>
        // åˆæœŸä½ç½®ï¼ˆæ±äº¬å‘¨è¾ºï¼‰
        const INITIAL_VIEW_STATE = {
            longitude: 139.6917,
            latitude: 35.6895,
            zoom: 10,
            pitch: 45,
            bearing: 0
        };

        // MapLibreGL ã®åˆæœŸåŒ–ï¼ˆOSM ã®ã‚¿ã‚¤ãƒ«ã‚’èƒŒæ™¯åœ°å›³ã«è¨­å®šï¼‰
        const map = new maplibregl.Map({
            container: 'map',
            style: {
                version: 8,
                sources: {
                    osm: {
                        type: 'raster',
                        tiles: ['https://tile.openstreetmap.org/{z}/{x}/{y}.png'], // OSM ã®ã‚¿ã‚¤ãƒ«URL
                        tileSize: 256,
                        attribution: '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors'
                    }
                },
                layers: [
                    {
                        id: 'osm-layer',
                        type: 'raster',
                        source: 'osm'
                    }
                ]
            },
            center: [INITIAL_VIEW_STATE.longitude, INITIAL_VIEW_STATE.latitude],
            zoom: INITIAL_VIEW_STATE.zoom,
            pitch: INITIAL_VIEW_STATE.pitch,
            bearing: INITIAL_VIEW_STATE.bearing,
            dragRotate: true // MapLibre å´ã§ãƒ‰ãƒ©ãƒƒã‚°å›è»¢ã‚’æœ‰åŠ¹åŒ–
        });

        // Deck.GL ã®åˆæœŸåŒ–ï¼ˆcontroller è¨­å®šã‚’ç´°ã‹ãåˆ¶å¾¡ï¼‰
        const deckgl = new deck.DeckGL({
            initialViewState: INITIAL_VIEW_STATE,
            controller: {
                dragPan: true, // ãƒ‰ãƒ©ãƒƒã‚°ã§ã®ç§»å‹•ã‚’æœ‰åŠ¹åŒ–
                dragRotate: true, // ãƒ‰ãƒ©ãƒƒã‚°ã§ã®å›è»¢ã‚’æœ‰åŠ¹åŒ–
                touchRotate: true, // ã‚¿ãƒƒãƒã‚¸ã‚§ã‚¹ãƒãƒ£ãƒ¼ã®å›è»¢ã‚’æœ‰åŠ¹åŒ–
                scrollZoom: { smooth: true }, // ã‚¹ãƒ ãƒ¼ã‚ºãªã‚ºãƒ¼ãƒ 
                doubleClickZoom: true
            },
            layers: [
                new deck.ScatterplotLayer({
                    id: 'scatter-layer',
                    data: generateRandomPoints(100), // 100å€‹ã®ãƒ©ãƒ³ãƒ€ãƒ ãªç‚¹
                    getPosition: d => d.position,
                    getRadius: 1000,
                    getFillColor: [255, 0, 0, 150], // åŠé€æ˜ã®èµ¤
                    pickable: true
                })
            ],
            onViewStateChange: ({ viewState }) => {
                map.jumpTo({
                    center: [viewState.longitude, viewState.latitude],
                    zoom: viewState.zoom,
                    pitch: viewState.pitch,
                    bearing: viewState.bearing
                });
            },
            getTooltip: ({ object }) => object && {
                html: `ğŸ“ ç·¯åº¦: ${object.position[1].toFixed(5)}<br>ğŸ“ çµŒåº¦: ${object.position[0].toFixed(5)}`,
                style: {
                    backgroundColor: 'white',
                    color: 'black',
                    fontSize: '12px',
                    padding: '5px',
                    borderRadius: '4px'
                }
            },
            onClick: ({ object }) => {
                if (object) {
                    alert(`ã‚¯ãƒªãƒƒã‚¯ã—ãŸãƒã‚¤ãƒ³ãƒˆ\nç·¯åº¦: ${object.position[1].toFixed(5)}\nçµŒåº¦: ${object.position[0].toFixed(5)}`);
                }
            }
        });

        // **å³ã‚¯ãƒªãƒƒã‚¯ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã‚’å®Œå…¨ã«ç„¡åŠ¹åŒ–**
        document.addEventListener('contextmenu', event => event.preventDefault());

        // ãƒ©ãƒ³ãƒ€ãƒ ãªãƒã‚¤ãƒ³ãƒˆã‚’ç”Ÿæˆã™ã‚‹é–¢æ•°
        function generateRandomPoints(numPoints) {
            const data = [];
            for (let i = 0; i < numPoints; i++) {
                data.push({
                    position: [
                        139.0 + Math.random() * 2, // 139-141 ã®ç¯„å›²
                        35.0 + Math.random() * 2  // 35-37 ã®ç¯„å›²
                    ]
                });
            }
            return data;
        }
    </script>
</body>

</html>
